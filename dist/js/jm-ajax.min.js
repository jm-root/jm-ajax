var jm=jm||{};"undefined"!=typeof module&&module.exports&&(jm=require("jm-core")),function(){if(!jm.ajax){var e=jm,t=jm.ERR,r=jm.getLogger("jm:ajax");"undefined"!=typeof module&&module.exports?e.ajax=require("najax"):function(e){var r={extend:function(e){return r.each(Array.prototype.slice.call(arguments,1),function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}),e},each:function(e,t,r){if(null!==e)if(n&&e.forEach===n)e.forEach(t,r);else if(e.length===+e.length){for(var a=0,o=e.length;a<o;a++)if(a in e&&t.call(r,e[a],a,e)===breaker)return}else for(var s in e)if(hasOwnProperty.call(e,s)&&t.call(r,e[s],s,e)===breaker)return}},a={};_xhrf=null;var n=Array.prototype.forEach,o=(r.each,r.extend);a.xhr=function(){return new XMLHttpRequest},a._xhrResp=function(e){switch(e.getResponseHeader("Content-Type").split(";")[0]){case"text/xml":return e.responseXML;case"text/json":case"application/json":case"text/javascript":case"application/javascript":case"application/x-javascript":try{return JSON.parse(e.responseText)}catch(e){return t.FAIL}default:return e.responseText}},a._formData=function(e){var t=[];for(var r in e)void 0!=e[r]&&null!=e[r]&&t.push(encodeURIComponent(r).replace(/%20/g,"+")+"="+encodeURIComponent(e[r].toString()).replace(/%20/g,"+"));return t.join("&")},a.ajax=function(e){var t=a.xhr(),r=null,n=0;if("function"==typeof t.open){e=o({userAgent:"XMLHttpRequest",lang:"en",type:"GET",data:null,contentType:"application/x-www-form-urlencoded"},e),e.timeout&&(r=setTimeout(function(){e.error.timeout=!0,t.abort(),e.timeoutFn&&e.timeoutFn(e.url)},e.timeout)),t.onreadystatechange=function(){4==t.readyState?(null!=r&&(clearTimeout(r),r=null),t.status>=200&&t.status<300||304===t.status?e.success&&e.success(a._xhrResp(t)):e.error&&e.error(t,t.status,t.statusText),e.complete&&e.complete(a._xhrResp(t),t,t.statusText)):e.progress&&e.progress(++n)};var s=e.url,i=null;e.type=(e.type||"GET").toUpperCase();var u="POST"==e.type||"PUT"==e.type;if(!u&&e.data&&(s+="?"+a._formData(e.data)),t.open(e.type,s),e.headers)for(var p in e.headers)e.headers[p]&&t.setRequestHeader(p,e.headers[p]);if(u){var c=e.contentType.indexOf("json")>=0;i=c?JSON.stringify(e.data):a._formData(e.data),t.setRequestHeader("Content-Type",c?"application/json":"application/x-www-form-urlencoded")}i?t.send(i):t.send()}},e.ajax=a.ajax}(e),jm.enableAjax=function(a,n){n=n||{};var o=n.ignoreDocErr||!1,s=n.types||["get","post","put","delete"],i=n.timeout||0;Array.isArray(s)||(s=[s]),s.forEach(function(n){a[n]=function(a,s){var u={};for(var p in a)u[p]=a[p];u.type=n.toUpperCase(),u.contentType=u.contentType||"application/json",u.dataType=u.dataType||"json",u.timeout=u.timeout||i,u.success=u.success||function(e){if(s){var t=null;e&&e.err&&!o&&(t=new Error(e.msg||e.err)),s(t,e)}},u.error=u.error||function(e,o,i){var p=n.toUpperCase()+" "+a.url;u.error.timeout&&(i=new Error("timeout")),i=i||new Error(p),r.debug("failed. "+p),s&&s(i,t.FA_NETWORK)},e.ajax(u)}})}}}();