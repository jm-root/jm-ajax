var jm=jm||{};"undefined"!=typeof module&&module.exports&&(jm=require("jm-core")),function(){if(!jm.ajax){var e=jm,t=jm.ERR,r=jm.getLogger("jm:ajax");"undefined"!=typeof module&&module.exports?e.ajax=require("najax"):!function(e){var r={extend:function(e){return r.each(Array.prototype.slice.call(arguments,1),function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}),e},each:function(e,t,r){if(null!==e)if(a&&e.forEach===a)e.forEach(t,r);else if(e.length===+e.length){for(var n=0,o=e.length;n<o;n++)if(n in e&&t.call(r,e[n],n,e)===breaker)return}else for(var s in e)if(hasOwnProperty.call(e,s)&&t.call(r,e[s],s,e)===breaker)return}},n={};_xhrf=null;var a=Array.prototype.forEach,o=(r.each,r.extend);n.xhr=function(){return new XMLHttpRequest},n._xhrResp=function(e){switch(e.getResponseHeader("Content-Type").split(";")[0]){case"text/xml":return e.responseXML;case"text/json":case"application/json":case"text/javascript":case"application/javascript":case"application/x-javascript":try{return JSON.parse(e.responseText)}catch(e){return t.FAIL}default:return e.responseText}},n._formData=function(e){var t=[],r=/%20/g;for(var n in e)void 0!=e[n]&&null!=e[n]&&t.push(encodeURIComponent(n).replace(r,"+")+"="+encodeURIComponent(e[n].toString()).replace(r,"+"));return t.join("&")},n.ajax=function(e){var t=n.xhr(),r=null,a=0;if("function"==typeof t.open){e=o({userAgent:"XMLHttpRequest",lang:"en",type:"GET",data:null,contentType:"application/x-www-form-urlencoded"},e),e.timeout&&(r=setTimeout(function(){e.error.timeout=!0,t.abort(),e.timeoutFn&&e.timeoutFn(e.url)},e.timeout)),t.onreadystatechange=function(){4==t.readyState?(null!=r&&(clearTimeout(r),r=null),t.status>=200&&t.status<300||304===t.status?e.success&&e.success(n._xhrResp(t)):e.error&&e.error(t,t.status,t.statusText),e.complete&&e.complete(n._xhrResp(t),t,t.statusText)):e.progress&&e.progress(++a)};var s=e.url,u=null;e.type=(e.type||"GET").toUpperCase();var i="POST"==e.type||"PUT"==e.type;if(!i&&e.data&&(s+="?"+n._formData(e.data)),t.open(e.type,s),i){var c=e.contentType.indexOf("json")>=0;u=c?JSON.stringify(e.data):n._formData(e.data),t.setRequestHeader("Content-Type",c?"application/json":"application/x-www-form-urlencoded")}u?t.send(u):t.send()}},e.ajax=n.ajax}(e),jm.enableAjax=function(n,a){a=a||{};var o=a.ignoreDocErr||!1,s=a.types||["get","post","put","delete"],u=a.timeout||0;Array.isArray(s)||(s=[s]),s.forEach(function(a){n[a]=function(n,s){var i={};for(var c in n)i[c]=n[c];i.type=a,i.contentType=i.contentType||"application/json",i.dataType=i.dataType||"json",i.timeout=i.timeout||u,i.success=i.success||function(e){if(s){var t=null;e&&e.err&&!o&&(t=new Error(e.msg||e.err)),s(t,e)}},i.error=i.error||function(e,o,u){var c=a.toUpperCase()+" "+n.url;i.error.timeout&&(u=new Error("timeout")),u=u||new Error(c),r.debug("failed. "+c),s&&s(u,t.FA_NETWORK)},e.ajax(i)}})}}}();